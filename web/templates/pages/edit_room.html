<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Favicon icon-->
  <link rel="shortcut icon" type="image/png" href="/assets/images/logos/favicon.png" />
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap"
    rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@2.44.0/tabler-icons.min.css">
  <!-- Core Css -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="/assets/css/theme.css" />
  <title>{{ .Title}}</title>
</head>

<body class=" bg-surface">
  <main>
    {{ template "header.html" . }}
    <!--start the project-->
    <div id="main-wrapper" class="flex p-5 xl:pr-0">
      <!-- sidebar -->
      {{ template "sidebar.html" . }}
      <!--end sidebar -->
      <div class=" w-full page-wrapper xl:px-6 px-0">

        <!-- Main Content -->
        <main class="h-full  max-w-full">
          <div class="container full-container p-0 flex flex-col gap-6">
            <div class="card">
              <div class="card-body flex flex-col gap-6">

                <div class="flex justify-between items-center mb-4">
                  <h6 class="text-lg text-gray-700 font-semibold">Edit room</h6>
                  <a href="/admin/rooms" class="text-blue-600 hover:underline">‚Üê Back to List</a>
                </div>

                <div class="card">
                  <div class="card-body">
                    <form method="POST" action="/admin/rooms/edit/{{.Room.ID}}" enctype="multipart/form-data">
                      <div class="grid grid-cols-1 gap-4">
                        <!-- Name -->
                        <div>
                          <label class="block text-sm mb-2 font-semibold text-gray-700">Room name</label>
                          <input type="text" name="name" value="{{.Room.Name}}" required
                            class="py-3 px-4 block w-full border-gray-200 rounded-xl text-sm focus:border-blue-600 focus:ring-0">
                        </div>

                        <!-- Type -->
                        <div>
                          <label class="block text-sm mb-2 font-semibold text-gray-700">Room type</label>
                          <input type="text" name="type" value="{{.Room.Type}}" required
                            class="py-3 px-4 block w-full border-gray-200 rounded-xl text-sm focus:border-blue-600 focus:ring-0">
                        </div>

                        <!-- Price Per Night -->
                        <div>
                          <label class="block text-sm mb-2 font-semibold text-gray-700">Price per night (VND)</label>
                          <input type="number" name="price_per_night" step="0.01" min="0"
                            value="{{.Room.PricePerNight}}" required
                            class="py-3 px-4 block w-full border-gray-200 rounded-xl text-sm focus:border-blue-600 focus:ring-0">
                        </div>

                        <!-- Bed Number -->
                        <div>
                          <label class="block text-sm mb-2 font-semibold text-gray-700">Number of beds</label>
                          <input type="number" name="bed_num" min="1" value="{{.Room.BedNum}}" required
                            class="py-3 px-4 block w-full border-gray-200 rounded-xl text-sm focus:border-blue-600 focus:ring-0">
                        </div>

                        <!-- View Type -->
                        <div>
                          <label class="block text-sm mb-2 font-semibold text-gray-700">View</label>
                          <input type="text" name="view_type" value="{{.Room.ViewType}}" required
                            class="py-3 px-4 block w-full border-gray-200 rounded-xl text-sm focus:border-blue-600 focus:ring-0">
                        </div>

                        <!-- Existing Images -->
                        <div>
                          <label class="block text-sm mb-2 font-semibold text-gray-700">Delete images ?</label>
                          <div class="grid grid-cols-2 gap-4">
                            {{ range .Room.Images }}
                            <div class="relative">
                              <img src="{{.ImageURL}}" class="rounded-xl object-cover w-full h-32 shadow">
                              <label class="absolute top-1 right-1 bg-white p-1 rounded">
                                <input type="checkbox" name="delete_image_ids" value="{{.ID}}">
                                <span class="text-sm text-red-600">üóë</span>
                              </label>
                            </div>
                            {{ end }}
                          </div>
                        </div>

                        <!-- Upload new images -->
                        <div>
                          <label class="block text-sm mb-2 font-semibold  text-gray-700">Room images</label>
                          <input type="file" name="images" id="image-input" multiple
                            class="py-3 px-4 block w-full border-gray-200 rounded-xl text-sm focus:border-blue-600 focus:ring-0"
                            accept="image/*">
                          <p class="text-xs text-gray-400 mt-1">You can select multiple images.</p>
                          <div id="preview" class="w-full mt-4 grid grid-cols-2 gap-4"></div>
                        </div>
                      </div>

                      <!-- Description -->
                      <div class="mt-4">
                        <label class="block text-sm mb-2 font-semibold text-gray-700">Description</label>
                        <textarea name="description" rows="4"
                          class="py-3 px-4 block w-full border-gray-200 rounded-xl text-sm focus:border-blue-600 focus:ring-0"
                          placeholder="Room description...">{{.Room.Description}}</textarea>
                      </div>

                      <!-- Checkboxes -->
                      <div class="flex items-center gap-6 mt-4">
                        <label class="flex items-center">
                          <input type="checkbox" name="has_aircon" {{if .Room.HasAircon}}checked{{end}}
                            class="shrink-0 mt-0.5 border-gray-400 rounded-[4px] text-blue-600 focus:ring-blue-500">
                          <span class="text-sm ms-2 font-semibold text-gray-700">Has air conditioner</span>
                        </label>
                        <label class="flex items-center">
                          <input type="checkbox" name="is_available" {{if .Room.IsAvailable}}checked{{end}}
                            class="shrink-0 mt-0.5 border-gray-400 rounded-[4px] text-blue-600 focus:ring-blue-500">
                          <span class="text-sm font-semibold text-gray-700 ms-2">Is available</span>
                        </label>
                      </div>

                      <!-- Error -->
                      {{ if .error }}
                      <p class="text-red-500 text-sm mb-4">{{ .error }}</p>
                      {{ end }}

                      <!-- Submit -->
                      <button type="submit"
                        class="rounded-xl mt-6 btn text-base py-2.5 text-white font-medium w-fit hover:bg-blue-700">
                        Save changes
                      </button>
                    </form>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </main>
        <!-- Main Content End -->

      </div>
    </div>
    <!--end of project-->
  </main>

  <script src="/assets/libs/jquery/dist/jquery.min.js"></script>
  <script src="/assets/libs/simplebar/dist/simplebar.min.js"></script>
  <script src="/assets/libs/iconify-icon/dist/iconify-icon.min.js"></script>
  <script src="/assets/js/sidebarmenu.js"></script>

  <!-- solar icons -->
  <script src="https://cdn.jsdelivr.net/npm/iconify-icon@1.0.8/dist/iconify-icon.min.js"></script>


  <script src="/assets/libs/apexcharts/dist/apexcharts.min.js"></script>
  <script src="/assets/js/dashboard.js"></script>
  <script>
    const input = document.getElementById('image-input');
    const preview = document.getElementById('preview');
    let selectedFiles = [];

    input.addEventListener('change', function (event) {
      selectedFiles = Array.from(event.target.files);
      preview.innerHTML = '';

      selectedFiles.forEach((file, index) => {
        if (!file.type.startsWith('image/')) return;

        const reader = new FileReader();
        reader.onload = function (e) {
          const wrapper = document.createElement('div');
          wrapper.className = 'relative w-full aspect-square overflow-hidden';

          const img = document.createElement('img');
          img.src = e.target.result;
          img.className = 'w-full h-full object-cover rounded shadow';

          const removeBtn = document.createElement('button');
          removeBtn.innerHTML = '&times;';
          removeBtn.className = 'absolute top-1 right-1 bg-gray-700 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm z-10';

          removeBtn.onclick = () => {
            selectedFiles.splice(index, 1);
            wrapper.remove();
            updateInputFiles();
          };

          wrapper.appendChild(img);
          wrapper.appendChild(removeBtn);
          preview.appendChild(wrapper);
        };
        reader.readAsDataURL(file);
      });
    });

    function updateInputFiles() {
      const dataTransfer = new DataTransfer();
      selectedFiles.forEach(file => dataTransfer.items.add(file));
      input.files = dataTransfer.files;
    }

  </script>
  <style>
    #preview {
      display: grid !important;
      grid-template-columns: repeat(2, 1fr) !important;
      gap: 1rem;
    }

    #preview button {
      z-index: 50 !important;
    }
  </style>

</body>

</html>